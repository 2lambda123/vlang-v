<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>V Mandelbrot WebAssembly Example</title>
</head>
<body>
	<canvas id="canvas" width="200" height="200" style="width:100%;height:100%;image-rendering: crisp-edges;"></canvas>
	<script>
		var canvas = document.getElementById("canvas");
		var ctx = canvas.getContext("2d");

		const env = {
		    __vsp: new WebAssembly.Global({value: "i32", mutable: true}, 0),
		    __vmem: new WebAssembly.Memory({initial: 256, maximum: 256}),
			canvas_x: () => canvas.width,
			canvas_y: () => canvas.height,
			setpixel: (x, y, c) => {
				ctx.fillStyle = "rgba(1,1,1,"+(c/255)+")";
				ctx.fillRect(x, y, 1, 1);
			}
		}

		WebAssembly.instantiateStreaming(fetch("mandelbrot.wasm"), {env: env}).then((res) => {
			console.log(canvas.width, canvas.height)
			res.instance.exports['main.main']()
		});
	</script>
</body>
</html>